/**
 * 文件範本管理系統
 * 提供完整的文件生成範本
 */

// 完整的文件範本數據
const DOCUMENT_TEMPLATES = {
    // Google Sheets 專用範本
    google_sheets: {
        financial_dashboard: {
            title: '財務儀表板 - Google Sheets',
            description: '適用於Google Sheets的財務追蹤儀表板',
            type: 'google_sheets',
            headers: ['項目', '1月', '2月', '3月', '4月', '5月', '6月', '合計', '平均'],
            rows: [
                ['收入', '=SUM(B3:B8)', '=SUM(C3:C8)', '=SUM(D3:D8)', '=SUM(E3:E8)', '=SUM(F3:F8)', '=SUM(G3:G8)', '=SUM(B2:G2)', '=AVERAGE(B2:G2)'],
                ['產品A銷售', '50000', '52000', '48000', '55000', '58000', '60000', '=SUM(B3:G3)', '=AVERAGE(B3:G3)'],
                ['產品B銷售', '30000', '32000', '28000', '35000', '38000', '40000', '=SUM(B4:G4)', '=AVERAGE(B4:G4)'],
                ['服務收入', '20000', '22000', '18000', '25000', '28000', '30000', '=SUM(B5:G5)', '=AVERAGE(B5:G5)'],
                ['其他收入', '5000', '5200', '4800', '5500', '5800', '6000', '=SUM(B6:G6)', '=AVERAGE(B6:G6)'],
                ['', '', '', '', '', '', '', '', ''],
                ['支出', '=SUM(B9:B14)', '=SUM(C9:C14)', '=SUM(D9:D14)', '=SUM(E9:E14)', '=SUM(F9:F14)', '=SUM(G9:G14)', '=SUM(B8:G8)', '=AVERAGE(B8:G8)'],
                ['人事費用', '35000', '35000', '35000', '37000', '37000', '38000', '=SUM(B9:G9)', '=AVERAGE(B9:G9)'],
                ['租金', '10000', '10000', '10000', '10000', '10000', '10000', '=SUM(B10:G10)', '=AVERAGE(B10:G10)'],
                ['行銷費用', '8000', '12000', '6000', '15000', '18000', '20000', '=SUM(B11:G11)', '=AVERAGE(B11:G11)'],
                ['營運費用', '5000', '5500', '4500', '6000', '6500', '7000', '=SUM(B12:G12)', '=AVERAGE(B12:G12)'],
                ['其他支出', '2000', '2200', '1800', '2500', '2800', '3000', '=SUM(B13:G13)', '=AVERAGE(B13:G13)'],
                ['', '', '', '', '', '', '', '', ''],
                ['淨利潤', '=B2-B8', '=C2-C8', '=D2-D8', '=E2-E8', '=F2-F8', '=G2-G8', '=H2-H8', '=I2-I8'],
                ['利潤率', '=(B15/B2)*100', '=(C15/C2)*100', '=(D15/D2)*100', '=(E15/E2)*100', '=(F15/F2)*100', '=(G15/G2)*100', '=(H15/H2)*100', '=(I15/I2)*100']
            ],
            formulas: {
                'B2': '=SUM(B3:B8)',
                'H2': '=SUM(B2:G2)',
                'I2': '=AVERAGE(B2:G2)'
            }
        },
        project_tracker: {
            title: '專案追蹤器 - Google Sheets',
            description: '具有自動計算功能的專案管理表',
            type: 'google_sheets',
            headers: ['任務ID', '任務名稱', '負責人', '開始日期', '預計完成', '實際完成', '狀態', '進度%', '剩餘天數'],
            rows: [
                ['T001', '需求分析', '張三', '2024/1/1', '2024/1/15', '', '進行中', '75', '=IF(G2="已完成",0,F2-TODAY())'],
                ['T002', '系統設計', '李四', '2024/1/16', '2024/2/1', '', '未開始', '0', '=IF(G3="已完成",0,F3-TODAY())'],
                ['T003', '前端開發', '王五', '2024/2/2', '2024/3/1', '', '未開始', '0', '=IF(G4="已完成",0,F4-TODAY())'],
                ['T004', '後端開發', '趙六', '2024/2/2', '2024/3/15', '', '未開始', '0', '=IF(G5="已完成",0,F5-TODAY())'],
                ['T005', '整合測試', '孫七', '2024/3/16', '2024/4/1', '', '未開始', '0', '=IF(G6="已完成",0,F6-TODAY())'],
                ['T006', '用戶驗收', '周八', '2024/4/2', '2024/4/15', '', '未開始', '0', '=IF(G7="已完成",0,F7-TODAY())'],
                ['T007', '部署上線', '吳九', '2024/4/16', '2024/4/30', '', '未開始', '0', '=IF(G8="已完成",0,F8-TODAY())'],
                ['', '', '', '', '', '', '', '', ''],
                ['專案總體進度', '', '', '', '', '', '', '=AVERAGE(H2:H8)', ''],
                ['已完成任務', '', '', '', '', '', '', '=COUNTIF(G2:G8,"已完成")', ''],
                ['總任務數', '', '', '', '', '', '', '=COUNTA(A2:A8)', ''],
                ['完成率', '', '', '', '', '', '', '=(H11/H12)*100', '']
            ]
        },
        inventory_management: {
            title: '庫存管理 - Google Sheets',
            description: '自動庫存追蹤與警報系統',
            type: 'google_sheets',
            headers: ['產品代碼', '產品名稱', '類別', '進貨數量', '出貨數量', '目前庫存', '安全庫存', '警報狀態', '補貨建議'],
            rows: [
                ['P001', '筆記型電腦', '電子產品', '100', '85', '=D2-E2', '20', '=IF(F2<G2,"警報","正常")', '=IF(F2<G2,G2-F2,"無需補貨")'],
                ['P002', '滑鼠', '電腦周邊', '200', '150', '=D3-E3', '30', '=IF(F3<G3,"警報","正常")', '=IF(F3<G3,G3-F3,"無需補貨")'],
                ['P003', '鍵盤', '電腦周邊', '150', '120', '=D4-E4', '25', '=IF(F4<G4,"警報","正常")', '=IF(F4<G4,G4-F4,"無需補貨")'],
                ['P004', '顯示器', '電子產品', '80', '65', '=D5-E5', '15', '=IF(F5<G5,"警報","正常")', '=IF(F5<G5,G5-F5,"無需補貨")'],
                ['P005', '印表機', '辦公設備', '50', '45', '=D6-E6', '10', '=IF(F6<G6,"警報","正常")', '=IF(F6<G6,G6-F6,"無需補貨")'],
                ['', '', '', '', '', '', '', '', ''],
                ['統計資料', '', '', '', '', '', '', '', ''],
                ['總產品數', '', '', '=COUNTA(A2:A6)', '', '', '', '', ''],
                ['警報產品數', '', '', '', '', '', '', '=COUNTIF(H2:H6,"警報")', ''],
                ['庫存總值', '', '', '', '', '', '', '', '']
            ]
        },
        employee_schedule: {
            title: '員工排班表 - Google Sheets',
            description: '自動計算工時的員工排班管理',
            type: 'google_sheets',
            headers: ['員工姓名', '週一', '週二', '週三', '週四', '週五', '週六', '週日', '週總時數', '加班時數'],
            rows: [
                ['張三', '9-18', '9-18', '9-18', '9-18', '9-18', '休息', '休息', '=40', '=MAX(0,I2-40)'],
                ['李四', '9-18', '9-18', '9-18', '9-18', '9-18', '9-15', '休息', '=46', '=MAX(0,I3-40)'],
                ['王五', '10-19', '10-19', '10-19', '10-19', '10-19', '休息', '休息', '=45', '=MAX(0,I4-40)'],
                ['趙六', '8-17', '8-17', '8-17', '8-17', '8-17', '8-12', '休息', '=49', '=MAX(0,I5-40)'],
                ['孫七', '9-18', '9-18', '休息', '9-18', '9-18', '9-18', '9-15', '=48', '=MAX(0,I6-40)'],
                ['', '', '', '', '', '', '', '', '', ''],
                ['統計', '', '', '', '', '', '', '', '', ''],
                ['總工時', '', '', '', '', '', '', '', '=SUM(I2:I6)', ''],
                ['平均工時', '', '', '', '', '', '', '', '=AVERAGE(I2:I6)', ''],
                ['總加班時數', '', '', '', '', '', '', '', '=SUM(J2:J6)', '']
            ]
        },
        sales_analytics: {
            title: '銷售分析 - Google Sheets',
            description: '銷售數據自動分析與圖表',
            type: 'google_sheets',
            headers: ['日期', '業務員', '產品', '數量', '單價', '總額', '成本', '利潤', '利潤率%'],
            rows: [
                ['2024/1/1', '張三', '產品A', '10', '1000', '=D2*E2', '=F2*0.6', '=F2-G2', '=(H2/F2)*100'],
                ['2024/1/2', '李四', '產品B', '5', '2000', '=D3*E3', '=F3*0.7', '=F3-G3', '=(H3/F3)*100'],
                ['2024/1/3', '王五', '產品C', '8', '1500', '=D4*E4', '=F4*0.5', '=F4-G4', '=(H4/F4)*100'],
                ['2024/1/4', '趙六', '產品A', '12', '1000', '=D5*E5', '=F5*0.6', '=F5-G5', '=(H5/F5)*100'],
                ['2024/1/5', '孫七', '產品B', '7', '2000', '=D6*E6', '=F6*0.7', '=F6-G6', '=(H6/F6)*100'],
                ['', '', '', '', '', '', '', '', ''],
                ['每日統計', '', '', '', '', '', '', '', ''],
                ['總銷售額', '', '', '', '', '=SUM(F2:F6)', '', '', ''],
                ['總成本', '', '', '', '', '', '=SUM(G2:G6)', '', ''],
                ['總利潤', '', '', '', '', '', '', '=SUM(H2:H6)', ''],
                ['平均利潤率', '', '', '', '', '', '', '', '=AVERAGE(I2:I6)']
            ]
        },
        budget_planner: {
            title: '預算規劃 - Google Sheets',
            description: '年度預算規劃與追蹤',
            type: 'google_sheets',
            headers: ['項目', '預算', '實際', '差異', '差異%', '狀態', '第一季', '第二季', '第三季', '第四季'],
            rows: [
                ['總收入', '=SUM(B3:B8)', '=SUM(C3:C8)', '=C2-B2', '=(D2/B2)*100', '=IF(D2>0,"超出","正常")', '=B2*0.25', '=B2*0.25', '=B2*0.25', '=B2*0.25'],
                ['產品銷售', '800000', '750000', '=C3-B3', '=(D3/B3)*100', '=IF(D3<0,"不足","正常")', '=B3*0.25', '=B3*0.25', '=B3*0.25', '=B3*0.25'],
                ['服務收入', '200000', '180000', '=C4-B4', '=(D4/B4)*100', '=IF(D4<0,"不足","正常")', '=B4*0.25', '=B4*0.25', '=B4*0.25', '=B4*0.25'],
                ['', '', '', '', '', '', '', '', '', ''],
                ['總支出', '=SUM(B6:B12)', '=SUM(C6:C12)', '=C5-B5', '=(D5/B5)*100', '=IF(D5>0,"超出","正常")', '=B5*0.25', '=B5*0.25', '=B5*0.25', '=B5*0.25'],
                ['人事費用', '400000', '420000', '=C6-B6', '=(D6/B6)*100', '=IF(D6>0,"超出","正常")', '=B6*0.25', '=B6*0.25', '=B6*0.25', '=B6*0.25'],
                ['行銷費用', '100000', '95000', '=C7-B7', '=(D7/B7)*100', '=IF(D7<0,"節省","正常")', '=B7*0.25', '=B7*0.25', '=B7*0.25', '=B7*0.25'],
                ['營運費用', '200000', '185000', '=C8-B8', '=(D8/B8)*100', '=IF(D8<0,"節省","正常")', '=B8*0.25', '=B8*0.25', '=B8*0.25', '=B8*0.25'],
                ['設備採購', '50000', '55000', '=C9-B9', '=(D9/B9)*100', '=IF(D9>0,"超出","正常")', '=B9*0.25', '=B9*0.25', '=B9*0.25', '=B9*0.25'],
                ['', '', '', '', '', '', '', '', '', ''],
                ['淨利潤', '=B2-B5', '=C2-C5', '=C11-B11', '=(D11/B11)*100', '=IF(D11>0,"超出預期","低於預期")', '=G2-G5', '=H2-H5', '=I2-I5', '=J2-J5']
            ]
        }
    },
    spreadsheet: {
        financial: {
            title: '財務報表',
            description: '公司財務收支統計表',
            headers: ['項目', '預算', '實際', '差異', '百分比', '備註'],
            rows: [
                ['收入', '', '', '', '', ''],
                ['銷售收入', '100000', '', '', '', ''],
                ['其他收入', '10000', '', '', '', ''],
                ['支出', '', '', '', '', ''],
                ['人事費用', '50000', '', '', '', ''],
                ['營運費用', '30000', '', '', '', ''],
                ['行銷費用', '15000', '', '', '', ''],
                ['淨利潤', '', '', '', '', '']
            ]
        },
        project: {
            title: '專案計劃',
            description: '專案任務規劃與追蹤表',
            headers: ['任務', '負責人', '開始日期', '結束日期', '狀態', '進度', '備註'],
            rows: [
                ['需求分析', '', '', '', '未開始', '0%', ''],
                ['系統設計', '', '', '', '未開始', '0%', ''],
                ['程式開發', '', '', '', '未開始', '0%', ''],
                ['測試階段', '', '', '', '未開始', '0%', ''],
                ['部署上線', '', '', '', '未開始', '0%', '']
            ]
        },
        employee: {
            title: '員工清單',
            description: '公司員工基本資料表',
            headers: ['員工編號', '姓名', '部門', '職位', '入職日期', '聯絡電話', '電子郵件'],
            rows: [
                ['E001', '張三', '技術部', '軟體工程師', '2024-01-15', '0912345678', 'zhang@company.com'],
                ['E002', '李四', '業務部', '業務專員', '2024-02-01', '0923456789', 'li@company.com'],
                ['E003', '王五', '人事部', '人事專員', '2024-03-01', '0934567890', 'wang@company.com']
            ]
        },
        sales: {
            title: '銷售統計',
            description: '月度銷售業績統計表',
            headers: ['日期', '產品', '數量', '單價', '總額', '業務員', '備註'],
            rows: [
                ['2025-01-01', '產品A', '10', '500', '5000', '張三', ''],
                ['2025-01-02', '產品B', '5', '800', '4000', '李四', ''],
                ['2025-01-03', '產品C', '8', '300', '2400', '王五', '']
            ]
        },
        inventory: {
            title: '庫存管理',
            description: '商品庫存追蹤表',
            headers: ['商品編號', '商品名稱', '類別', '庫存數量', '安全庫存', '供應商', '最後更新'],
            rows: [
                ['P001', '筆記型電腦', '電子產品', '100', '20', '科技供應商', '2025-01-01'],
                ['P002', '商務襯衫', '服飾', '50', '10', '服飾供應商', '2025-01-01'],
                ['P003', '咖啡豆', '食品', '200', '30', '食品供應商', '2025-01-01']
            ]
        },
        schedule: {
            title: '工作排程',
            description: '每週工作時程安排表',
            headers: ['時間', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六', '星期日'],
            rows: [
                ['09:00-10:00', '會議', '專案開發', '客戶拜訪', '程式設計', '測試', '', ''],
                ['10:00-11:00', '專案開發', '需求分析', '文件撰寫', '代碼審查', '部署', '', ''],
                ['11:00-12:00', '團隊討論', '設計會議', '系統測試', '客戶支援', '維護', '', ''],
                ['13:00-14:00', '午餐會議', '技術研究', '培訓課程', '專案會議', '報告撰寫', '', ''],
                ['14:00-15:00', '代碼開發', '測試執行', '客戶溝通', '技術支援', '系統優化', '', ''],
                ['15:00-16:00', '文件整理', '進度檢查', '問題解決', '團隊協作', '週報準備', '', ''],
                ['16:00-17:00', '日報撰寫', '計劃安排', '總結會議', '準備工作', '週末規劃', '', '']
            ]
        },
        budget: {
            title: '年度預算',
            description: '年度預算規劃與執行表',
            headers: ['項目', 'Q1預算', 'Q1實際', 'Q2預算', 'Q2實際', 'Q3預算', 'Q3實際', 'Q4預算', 'Q4實際', '年度總計'],
            rows: [
                ['營收', '250000', '245000', '280000', '285000', '300000', '', '320000', '', '1150000'],
                ['人事成本', '100000', '98000', '105000', '107000', '110000', '', '115000', '', '430000'],
                ['營運成本', '80000', '82000', '85000', '83000', '90000', '', '95000', '', '350000'],
                ['行銷費用', '30000', '28000', '35000', '38000', '40000', '', '45000', '', '150000'],
                ['淨利潤', '40000', '37000', '55000', '57000', '60000', '', '65000', '', '220000']
            ]
        },
        attendance: {
            title: '出勤記錄',
            description: '員工出勤統計表',
            headers: ['員工姓名', '部門', '工號', '出勤天數', '遲到次數', '早退次數', '請假天數', '加班時數', '備註'],
            rows: [
                ['張三', '技術部', 'E001', '22', '0', '0', '0', '8', '表現優秀'],
                ['李四', '業務部', 'E002', '21', '1', '0', '1', '12', '業績達標'],
                ['王五', '人事部', 'E003', '22', '0', '0', '0', '5', '工作穩定']
            ]
        }
    },
    document: {
        meeting: {
            title: '會議紀錄',
            description: '標準會議紀錄範本',
            content: `會議紀錄

會議主題：月度團隊會議
日期時間：2025年1月15日 下午2:00-3:30
地點：會議室A
主持人：張經理
出席人員：張三、李四、王五、趙六

## 議程
1. 上月工作總結
2. 本月工作計劃
3. 新專案討論
4. 其他事項

## 討論內容

### 上月工作總結
- 完成了客戶管理系統的開發
- 銷售業績達成目標的110%
- 團隊協作效率提升

### 本月工作計劃
- 啟動新的移動應用開發專案
- 加強客戶服務品質
- 舉辦技術培訓課程

## 決議事項
1. 批准新專案預算50萬元
2. 安排團隊成員技術培訓
3. 制定客戶滿意度調查計劃

## 待辦事項
| 項目 | 負責人 | 期限 |
|------|--------|------|
| 專案需求分析 | 張三 | 1月20日 |
| 預算申請表單 | 李四 | 1月18日 |
| 培訓課程安排 | 王五 | 1月25日 |

## 下次會議
日期：2025年2月15日 下午2:00
地點：會議室A`
        },
        proposal: {
            title: '項目提案',
            description: '標準項目提案書範本',
            content: `項目提案書

提案標題：智慧辦公系統開發專案
提案人：張技術總監
提案日期：2025年1月15日

## 一、背景與目標

### 1.1 專案背景
隨著公司業務快速成長，現有的辦公系統已無法滿足日益增長的需求。為了提高工作效率，減少人工作業錯誤，需要開發一套智慧化的辦公系統。

### 1.2 專案目標
- 提升辦公效率50%
- 減少人工錯誤率至1%以下
- 建立統一的數據管理平台
- 實現無紙化辦公

## 二、解決方案

### 2.1 方案概述
開發一套集成文件管理、流程審批、數據分析於一體的智慧辦公系統，包含Web端和移動端應用。

### 2.2 實施計劃
1. 需求分析與系統設計（4週）
2. 核心功能開發（12週）
3. 系統測試與優化（4週）
4. 部署上線與培訓（2週）

## 三、資源需求

### 3.1 人力資源
- 專案經理：1名
- 系統架構師：1名
- 後端開發工程師：3名
- 前端開發工程師：2名
- UI/UX設計師：1名
- 測試工程師：2名

### 3.2 預算需求
- 人力成本：150萬元
- 硬體設備：30萬元
- 軟體授權：20萬元
- 其他費用：10萬元
- 總計：210萬元

## 四、效益評估

### 4.1 預期效益
- 年度節省人力成本：100萬元
- 提升工作效率，增加產值：300萬元
- 改善客戶滿意度，增加收益：200萬元

### 4.2 風險評估
- 技術風險：中等（可透過技術調研降低）
- 進度風險：低（有經驗豐富的團隊）
- 預算風險：低（預算合理且有10%緩衝）

## 五、時程規劃
| 階段 | 時間 | 里程碑 |
|------|------|--------|
| 需求分析 | Week 1-4 | 完成需求文件 |
| 系統設計 | Week 5-6 | 完成設計文件 |
| 開發階段 | Week 7-18 | 功能模組完成 |
| 測試階段 | Week 19-22 | 系統測試完成 |
| 部署上線 | Week 23-24 | 正式上線運行 |

## 六、結論
本專案具有明確的商業價值和技術可行性，建議立即啟動。預期投資回報率達到190%，是一個值得投資的專案。`
        },
        contract: {
            title: '合約範本',
            description: '標準合約協議書範本',
            content: `合約協議書

甲方：ABC科技有限公司
乙方：XYZ軟體開發公司
簽約日期：2025年1月15日

## 第一條 合約標的
本合約內容為智慧辦公系統開發專案，包含系統分析、設計、開發、測試及部署等完整服務。

## 第二條 權利義務

### 甲方權利義務：
1. 提供專案需求規格說明
2. 配合系統測試與驗收作業
3. 按合約規定支付專案費用
4. 提供必要的系統環境與資源

### 乙方權利義務：
1. 按時完成專案開發工作
2. 確保系統品質符合需求規格
3. 提供系統操作手冊與技術文件
4. 提供3個月免費維護服務

## 第三條 付款條件
付款方式：分期付款
付款期限：
- 簽約時支付30%（63萬元）
- 系統測試完成後支付40%（84萬元）
- 系統驗收完成後支付30%（63萬元）
付款金額：總計新台幣210萬元

## 第四條 違約責任
1. 如甲方延遲付款超過30天，乙方有權暫停專案進行
2. 如乙方延遲交付超過2週，需支付合約金額2%之違約金
3. 任一方如需終止合約，需提前30天書面通知

## 第五條 爭議解決
如有爭議，雙方應協商解決，協商不成時，提交台北地方法院仲裁委員會仲裁。

## 第六條 其他條款
1. 本合約一式兩份，甲乙雙方各執一份
2. 本合約自雙方簽字蓋章之日起生效
3. 未盡事宜，雙方可另行協商

甲方簽名：_____________ 日期：_________
乙方簽名：_____________ 日期：_________`
        },
        report: {
            title: '工作報告',
            description: '工作成果報告範本',
            content: `工作報告

報告人：張三
報告日期：2025年1月15日
報告期間：2024年12月1日 - 2024年12月31日

## 一、工作概況

### 1.1 主要工作內容
- 完成客戶管理系統功能開發
- 參與系統架構設計會議
- 協助新進同事技術培訓
- 撰寫技術文件與操作手冊

### 1.2 完成情況
- 按時完成所有指派任務
- 系統功能測試通過率100%
- 客戶滿意度調查獲得9.2分（滿分10分）
- 技術文件獲得團隊好評

## 二、具體成果

### 2.1 量化指標
| 指標 | 目標值 | 實際值 | 達成率 |
|------|--------|--------|--------|
| 功能完成度 | 95% | 100% | 105% |
| 程式碼品質 | 85分 | 92分 | 108% |
| 客戶滿意度 | 8.5分 | 9.2分 | 108% |
| 文件完整度 | 90% | 95% | 106% |

### 2.2 質化成果
- 成功解決系統效能瓶頸問題
- 建立了完整的開發流程文件
- 提升團隊整體技術水準
- 獲得客戶高度讚賞與肯定

## 三、遇到的問題

### 3.1 主要困難
- 第三方API整合遇到技術挑戰
- 系統效能優化需要額外時間
- 跨部門協調溝通需要改善

### 3.2 解決方案
- 與API供應商技術團隊密切合作
- 採用新的快取機制提升效能
- 建立定期跨部門會議機制

## 四、下期工作計劃

### 4.1 工作重點
- 啟動移動應用開發專案
- 優化現有系統使用者體驗
- 加強技術團隊能力建設
- 探索新技術應用可能性

### 4.2 預期目標
- 完成移動端核心功能開發
- 系統回應時間縮短50%
- 團隊技術水準再提升20%
- 申請2項技術專利

## 五、建議與反思
- 建議增加跨部門溝通機制
- 需要投資更多資源在技術研發
- 應該建立更完善的知識管理系統
- 持續關注業界最新技術趨勢`
        },
        policy: {
            title: '公司政策',
            description: '公司制度政策範本',
            content: `公司政策文件

政策名稱：遠距工作管理辦法
制定部門：人力資源部
生效日期：2025年2月1日
版本：1.0

## 一、政策目的
本政策旨在規範員工遠距工作的申請、執行與管理，確保工作品質與效率，同時兼顧員工工作彈性需求。

## 二、適用範圍
本政策適用於本公司所有正式員工，試用期員工需經主管特別核准。

## 三、定義
- 遠距工作：員工在公司辦公室以外的地點執行工作
- 混合工作：結合辦公室工作與遠距工作的彈性安排
- 工作日：公司規定的正常工作時間

## 四、政策內容

### 4.1 基本原則
- 工作效率與品質不得因遠距工作而降低
- 必須維持良好的團隊溝通與協作
- 遵守公司所有相關規章制度
- 確保資訊安全與機密保護

### 4.2 具體規定
- 每週遠距工作天數最多3天
- 必須在核准的工作地點執行業務
- 需要建立明確的工作目標與時程
- 定期向主管回報工作進度

### 4.3 執行程序
1. 提交遠距工作申請表
2. 主管審核與評估
3. 人事部門核准備案
4. 簽署遠距工作協議
5. 開始執行並定期檢討

## 五、責任分工
| 職位 | 責任 |
|------|------|
| 員工 | 維持工作品質，遵守規定 |
| 主管 | 審核申請，監督執行 |
| 人事部 | 政策執行，績效追蹤 |
| IT部門 | 技術支援，資安維護 |

## 六、監督檢查
- 每月進行工作成效評估
- 季度檢討遠距工作政策執行狀況
- 年度調查員工滿意度與建議

## 七、違規處理
- 首次違規：口頭警告
- 二次違規：書面警告
- 三次違規：暫停遠距工作權利
- 嚴重違規：依公司人事規定處理

## 八、附則
1. 本政策解釋權歸人力資源部門
2. 本政策自發布之日起執行
3. 如有修訂，另行通知

制定人：人事經理 李小姐 日期：2025/01/15
審核人：副總經理 王先生 日期：2025/01/18
批准人：總經理 陳先生 日期：2025/01/20`
        },
        manual: {
            title: '操作手冊',
            description: '標準操作手冊範本',
            content: `系統操作手冊

手冊名稱：客戶管理系統操作手冊
版本：2.0
制定日期：2025年1月15日
最後更新：2025年1月15日

## 一、概述

### 1.1 目的
本手冊旨在指導使用者正確操作客戶管理系統，提高工作效率，確保資料正確性。

### 1.2 適用範圍
- 業務部門同事
- 客服部門同事
- 行銷部門同事
- 主管階層人員

## 二、準備工作

### 2.1 所需工具
- 電腦或平板設備
- 穩定的網路連線
- 現代化網頁瀏覽器（Chrome、Firefox、Safari、Edge）
- 公司分配的帳號密碼

### 2.2 前置條件
- 已完成系統教育訓練
- 獲得系統使用權限
- 了解客戶資料保密規定

## 三、操作步驟

### 3.1 步驟一：系統登入
1. 開啟網頁瀏覽器
2. 輸入系統網址：https://crm.company.com
3. 輸入帳號與密碼
4. 點擊「登入」按鈕
5. 驗證身份（如需要）

### 3.2 步驟二：客戶資料建立
1. 點擊「新增客戶」按鈕
2. 填寫基本資料（必填欄位標示*）
3. 上傳客戶相關文件
4. 設定客戶分類與標籤
5. 儲存資料並確認

### 3.3 步驟三：客戶資料查詢
1. 使用搜尋功能輸入關鍵字
2. 選擇進階篩選條件
3. 檢視搜尋結果
4. 點擊客戶姓名查看詳細資料
5. 編輯或更新資料（如需要）

### 3.4 步驟四：產生報表
1. 進入「報表」功能頁面
2. 選擇報表類型與時間範圍
3. 設定報表參數
4. 預覽報表內容
5. 下載或列印報表

## 四、注意事項

### 4.1 安全須知
- 不可與他人分享帳號密碼
- 離開電腦時務必登出系統
- 定期更換密碼（建議3個月一次）
- 發現異常活動立即通報IT部門

### 4.2 重要提醒
- 客戶資料僅供業務使用，不得外洩
- 定期備份重要資料
- 系統維護時間：每週日凌晨2:00-4:00
- 遇到問題時先查閱FAQ，無法解決再尋求協助

## 五、常見問題

### Q1: 忘記密碼怎麼辦？
A1: 點擊登入頁面的「忘記密碼」連結，或聯絡IT部門重設。

### Q2: 系統回應很慢怎麼辦？
A2: 檢查網路連線，清除瀏覽器快取，或嘗試重新登入。

### Q3: 如何匯出客戶清單？
A3: 進入客戶列表頁面，點擊「匯出」按鈕，選擇檔案格式即可。

### Q4: 可以同時開啟多個分頁嗎？
A4: 建議只開啟一個分頁使用，避免資料衝突。

### Q5: 如何設定客戶提醒？
A5: 在客戶詳細頁面點擊「設定提醒」，選擇提醒時間與內容。

## 六、聯絡資訊
技術支援：IT部門 分機1234 或 it-support@company.com
緊急聯絡：值班工程師 0912-345-678
更新維護：系統管理員 分機5678

如有任何疑問或建議，歡迎隨時聯絡我們！`
        }
    }
};

// 顯示範本選擇介面
function showDocumentTemplates() {
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.id = 'templateModal';
    modal.setAttribute('tabindex', '-1');
    
    modal.innerHTML = `
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">選擇文件範本</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="mb-3"><i class="fas fa-table text-success"></i> 試算表範本</h6>
                            <div class="list-group mb-4" id="spreadsheet-templates">
                                ${generateTemplateList('spreadsheet')}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6 class="mb-3"><i class="fas fa-file-word text-primary"></i> 文件範本</h6>
                            <div class="list-group" id="document-templates">
                                ${generateTemplateList('document')}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    const modalInstance = new bootstrap.Modal(modal);
    modalInstance.show();
    
    // 清理DOM
    modal.addEventListener('hidden.bs.modal', () => {
        document.body.removeChild(modal);
    });
}

// 生成範本列表HTML
function generateTemplateList(type) {
    const templates = DOCUMENT_TEMPLATES[type];
    return Object.keys(templates).map(key => {
        const template = templates[key];
        return `
            <button class="list-group-item list-group-item-action" 
                    onclick="generateFromTemplate('${type}', '${key}')">
                <div class="d-flex w-100 justify-content-between">
                    <h6 class="mb-1">${template.title}</h6>
                    <small class="text-muted">${type === 'spreadsheet' ? 'Excel' : 'Word'}</small>
                </div>
                <p class="mb-1 text-muted small">${template.description}</p>
            </button>
        `;
    }).join('');
}

// 從範本生成文件
async function generateFromTemplate(templateType, templateName) {
    try {
        // 關閉modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('templateModal'));
        modal.hide();
        
        // 顯示生成中提示
        showMessage('正在生成文件...', 'info');
        
        const templateData = DOCUMENT_TEMPLATES[templateType][templateName];
        
        // 發送生成請求
        const response = await fetch('/generate_document', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                method: 'template',
                template_type: templateType,
                template_name: templateName,
                language: 'zh-TW'
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            showMessage(`${result.title} 生成成功！`, 'success');
            
            // 顯示下載鏈接
            const downloadHtml = `
                <div class="alert alert-success">
                    <h6><i class="fas fa-check-circle"></i> 文件生成完成</h6>
                    <p><strong>檔案名稱：</strong>${result.filename}</p>
                    <p><strong>檔案類型：</strong>${result.type}</p>
                    <a href="${result.download_url}" class="btn btn-success" download>
                        <i class="fas fa-download"></i> 下載文件
                    </a>
                </div>
            `;
            
            // 在聊天框中顯示下載連結
            if (window.aiAssistant && window.aiAssistant.addMessage) {
                window.aiAssistant.addMessage(downloadHtml, 'assistant');
            }
        } else {
            showMessage(`生成失敗：${result.error}`, 'error');
        }
    } catch (error) {
        console.error('生成文件時發生錯誤：', error);
        showMessage('生成文件時發生錯誤', 'error');
    }
}

// 顯示訊息提示
function showMessage(message, type) {
    const alertClass = type === 'success' ? 'alert-success' : 
                      type === 'error' ? 'alert-danger' : 'alert-info';
    
    const alert = document.createElement('div');
    alert.className = `alert ${alertClass} alert-dismissible fade show position-fixed`;
    alert.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    alert.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alert);
    
    // 自動移除
    setTimeout(() => {
        if (alert.parentNode) {
            alert.parentNode.removeChild(alert);
        }
    }, 5000);
}

// 導出到全域
window.showDocumentTemplates = showDocumentTemplates;
window.generateFromTemplate = generateFromTemplate;